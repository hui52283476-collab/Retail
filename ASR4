import urllib.request
import urllib.parse
import json
import os

# OpenRouter API網址
openrouter_url = "https://openrouter.ai/api/v1/chat/completions"

# 自己填上API KEY
OPENROUTER_API_KEY = "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"

# 讀txt檔內容
with open("NOTTA_gen.txt", "r", encoding="utf-8") as f:
    input_text = f.read()

# 準備API請求資料
send_data = {
    "model": "tngtech/deepseek-r1t2-chimera:free",  # 或換成其他OpenRouter支援的model
    "messages": [
        {"role": "system", "content": "你是一個會為用戶摘要內容的助理。"},
        {"role": "user", "content": "請幫我摘要以下文字：" + input_text}
    ]
}
request_body = json.dumps(send_data).encode("utf-8")

# 設定HTTP header
headers = {
    "Authorization": f"Bearer {OPENROUTER_API_KEY}",
    "Content-Type": "application/json"
}

req = urllib.request.Request(
    url=openrouter_url,
    data=request_body,
    headers=headers,
    method="POST"
)

# 執行API請求，獲得摘要
with urllib.request.urlopen(req) as response:
    result = response.read()
    result_json = json.loads(result)
    summary = result_json["choices"][0]["message"]["content"]

# 把摘要存成新的檔案
with open("summary.txt", "w", encoding="utf-8") as f:
    f.write(summary)

print("已完成摘要！結果在 summary.txt")
